<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="da"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>DBBuildingHandler.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;SundeBygninger&quot; (powered by JaCoCo from EclEmma)</a> &gt; <a href="index.source.html" class="el_package">DbHandler</a> &gt; <span class="el_source">DBBuildingHandler.java</span></div><h1>DBBuildingHandler.java</h1><pre class="source lang-java linenums">/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package DbHandler;

import entities.Building;
import entities.User;
import java.awt.HeadlessException;
import java.awt.Image;
import java.awt.image.BufferedImage;
import java.io.InputStream;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;
import java.security.SecureRandom;
import java.sql.Blob;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Date;
import java.sql.Statement;
import java.util.ArrayList;
import javax.imageio.ImageIO;
import javax.servlet.http.Part;
import javax.swing.JOptionPane;

public class DBBuildingHandler {

    Connection conn;
    
<span class="nc" id="L33">    public DBBuildingHandler() {</span>
<span class="nc" id="L34">        this.conn = DBConnection.getConnection();</span>
<span class="nc" id="L35">    }</span>
    
<span class="fc" id="L37">    public DBBuildingHandler(Connection conn) {</span>
<span class="fc" id="L38">        this.conn = conn;</span>
<span class="fc" id="L39">    }</span>
    
    public void addBuilding(Building b) {
<span class="fc" id="L42">        addBuilding(b.getAddress(), b.getCadastral(), b.getBuiltYear(), b.getArea(), b.getZipcode(), b.getCity(), </span>
<span class="fc" id="L43">                    b.getCondition(), b.getService(), b.getExtraText(), b.getDateCreated(), b.getFk_idUser(), b.getFk_idMainPicture(), b.getFk_idReport());</span>
<span class="fc" id="L44">    }</span>
    
    public void addBuilding(String address, String cadastral, String builtYear,
            String area, String zipcode, String city, String conditionText,
            String service, String extraText, String dateCreated, int fk_idUser,
            int fk_idMainPicture, int fk_idReport) {

        try {
<span class="fc" id="L52">            String sql = &quot;INSERT INTO building (address, cadastral, builtYear, area, zipcode, city, conditionText, service, extraText, dateCreated, fk_idUser, fk_idMainPicture, fk_idReport)&quot;</span>
                    + &quot;VALUES (?,?,?,?,?,?,?,?,?,?,(select idUser from user where idUser=?),null,null)&quot;;
<span class="fc" id="L54">            PreparedStatement prepared = conn.prepareStatement(sql);</span>

<span class="fc" id="L56">            prepared.setString(1, address);</span>
<span class="fc" id="L57">            prepared.setString(2, cadastral);</span>
<span class="fc" id="L58">            prepared.setString(3, builtYear);</span>
<span class="fc" id="L59">            prepared.setString(4, area);</span>
<span class="fc" id="L60">            prepared.setString(5, zipcode);</span>
<span class="fc" id="L61">            prepared.setString(6, city);</span>
<span class="fc" id="L62">            prepared.setString(7, conditionText);</span>
<span class="fc" id="L63">            prepared.setString(8, service);</span>
<span class="fc" id="L64">            prepared.setString(9, extraText);</span>
<span class="fc" id="L65">            prepared.setString(10, dateCreated);</span>
<span class="fc" id="L66">            prepared.setInt(11, fk_idUser);</span>
            //prepared.setInt(12, fk_idMainPicture);
            //prepared.setInt(13, fk_idReport);

<span class="fc" id="L70">            prepared.executeUpdate();</span>
<span class="nc" id="L71">        } catch (SQLException | HeadlessException ex) {</span>
<span class="nc" id="L72">            JOptionPane.showMessageDialog(null, &quot;[DBBuiling.addBuilding] &quot; + ex);</span>
<span class="fc" id="L73">        }</span>

<span class="fc" id="L75">    }</span>

    public String getBuildings(int idUser) {
<span class="nc" id="L78">        String tableData = &quot;&lt;table class='table table-hover'&gt;\n&quot;</span>
                + &quot;    &lt;thead&gt;\n&quot;
                + &quot;      &lt;tr&gt;\n&quot;
                + &quot;        &lt;th&gt;Thumbnail&lt;/th&gt;\n&quot;
                + &quot;        &lt;th&gt;Address&lt;/th&gt;\n&quot;
                + &quot;        &lt;th&gt;Zipcode&lt;/th&gt;\n&quot;
                + &quot;        &lt;th&gt;City&lt;/th&gt;\n&quot;
                + &quot;        &lt;th&gt;Edit Building&lt;/th&gt;\n&quot;
                + &quot;        &lt;th&gt;Remove Building&lt;/th&gt;\n&quot;
                + &quot;        &lt;th&gt;Service Building&lt;/th&gt;\n&quot;
                + &quot;      &lt;/tr&gt;\n&quot;
                + &quot;    &lt;/thead&gt;\n&quot;
                + &quot;    &lt;tbody&gt;&quot;;
        try {
            /*
    int idBuilding, String address, String cadastral, String buildingGrade, 
    String area, String zipcode, String city, String condition, String service, 
    String extraText, double buildingArea, int builtYear, int fk_idUser, 
    int fk_MainPicture, int fk_idReport, Date dateCreated
             */

<span class="nc" id="L99">            String sql = &quot;SELECT * FROM building WHERE fk_idUser=?&quot;;</span>
<span class="nc" id="L100">            PreparedStatement prepared = conn.prepareStatement(sql);</span>
<span class="nc" id="L101">            prepared.setInt(1, idUser);</span>
<span class="nc" id="L102">            ResultSet myRS = prepared.executeQuery();</span>
<span class="nc" id="L103">            int id = 1;</span>
<span class="nc bnc" id="L104" title="All 2 branches missed.">            while (myRS.next()) {</span>
<span class="nc" id="L105">                int idBuilding = myRS.getInt(&quot;idBuilding&quot;);</span>
<span class="nc" id="L106">                int imageID = myRS.getInt(&quot;fk_idMainPicture&quot;);</span>
<span class="nc" id="L107">                String address = myRS.getString(&quot;address&quot;);</span>
<span class="nc" id="L108">                String city = myRS.getString(&quot;city&quot;);</span>
<span class="nc" id="L109">                String zipcode = myRS.getString(&quot;zipcode&quot;);</span>
<span class="nc" id="L110">                tableData += &quot;&lt;tr&gt;&lt;td&gt;&quot; + getImageHTML(imageID, 50, 50)</span>
                        + &quot;&lt;td&gt;&quot; + address + &quot;&lt;/td&gt;&lt;td&gt;&quot; + zipcode + &quot;&lt;/td&gt;&lt;td&gt;&quot; + city
                        + &quot;&lt;form action='Front' method='POST'&gt;&lt;input type='hidden' name='methodForm' value='editBuilding'&gt;&lt;td&gt;&lt;button class='editbtn' type='submit'&gt;Show/Edit&lt;/button&gt;&lt;/td&gt;&quot;
                        + &quot;&lt;input type='hidden' name='idBuilding' value='&quot; + idBuilding + &quot;'&gt;&lt;/td&gt;&quot;
                        + &quot;&lt;/form&gt;&quot;
                        + &quot;&lt;form action='Front' method='POST'&gt;&lt;input type='hidden' name='methodForm' value='deleteBuilding'&gt;&lt;td&gt;&lt;button class='dltbtn' type='submit'&gt;Delete&lt;/button&gt;&lt;/td&gt;&quot;
                        + &quot;&lt;input type='hidden' name='idBuilding' value='&quot; + idBuilding + &quot;'&gt;&lt;/td&gt;&quot;
                        + &quot;&lt;/form&gt;&quot;
                        + &quot;&lt;form action='Front' method='POST'&gt;&lt;input type='hidden' name='methodForm' value='getService'&gt;&lt;td&gt;&lt;button class='srvbtn' type='submit'&gt;Service&lt;/button&gt;&lt;/td&gt;&quot;
                        + &quot;&lt;input type='hidden' name='idBuilding' value='&quot; + idBuilding + &quot;'&gt;&lt;/td&gt;&quot;
                        + &quot;&lt;/form&gt;&quot;
                        + &quot;&lt;/tr&gt;&quot;;
<span class="nc" id="L122">                id++;</span>
<span class="nc" id="L123">            }</span>
<span class="nc" id="L124">        } catch (SQLException | HeadlessException ex) {</span>

<span class="nc" id="L126">        }</span>
<span class="nc" id="L127">        tableData += &quot;&lt;/tbody&gt;\n&quot;</span>
                + &quot;  &lt;/table&gt;&quot;;
<span class="nc" id="L129">        return tableData;</span>
    }

    public Building getBuilding(int idUser) {
<span class="nc" id="L133">        Building building = null;</span>
        try {
<span class="nc" id="L135">            String sql = &quot;SELECT * FROM building WHERE idBuilding=?&quot;;</span>
<span class="nc" id="L136">            PreparedStatement prepared = conn.prepareStatement(sql);</span>
<span class="nc" id="L137">            prepared.setInt(1, idUser);</span>
<span class="nc" id="L138">            ResultSet myRS = prepared.executeQuery();</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">            while (myRS.next()) {</span>
<span class="nc" id="L140">                building = new Building(</span>
<span class="nc" id="L141">                        myRS.getInt(&quot;idBuilding&quot;),</span>
<span class="nc" id="L142">                        myRS.getString(&quot;address&quot;),</span>
<span class="nc" id="L143">                        myRS.getString(&quot;cadastral&quot;),</span>
<span class="nc" id="L144">                        myRS.getString(&quot;area&quot;),</span>
<span class="nc" id="L145">                        myRS.getString(&quot;zipcode&quot;),</span>
<span class="nc" id="L146">                        myRS.getString(&quot;city&quot;),</span>
<span class="nc" id="L147">                        myRS.getString(&quot;conditionText&quot;),</span>
<span class="nc" id="L148">                        myRS.getString(&quot;service&quot;),</span>
<span class="nc" id="L149">                        myRS.getString(&quot;extraText&quot;),</span>
<span class="nc" id="L150">                        myRS.getString(&quot;builtYear&quot;),</span>
<span class="nc" id="L151">                        myRS.getInt(&quot;fk_idUser&quot;),</span>
<span class="nc" id="L152">                        myRS.getInt(&quot;fk_idMainPicture&quot;),</span>
<span class="nc" id="L153">                        myRS.getInt(&quot;fk_idReport&quot;),</span>
<span class="nc" id="L154">                        myRS.getString(&quot;dateCreated&quot;)</span>
                );
            }

<span class="nc" id="L158">        } catch (SQLException | HeadlessException ex) {</span>

<span class="nc" id="L160">        }</span>
<span class="nc" id="L161">        return building;</span>
    }

    public Building getBuilding(String address) {
<span class="fc" id="L165">        Building building = null;</span>
        try {
<span class="fc" id="L167">            String sql = &quot;SELECT * FROM building WHERE address=?&quot;;</span>
<span class="fc" id="L168">            PreparedStatement prepared = conn.prepareStatement(sql);</span>
<span class="fc" id="L169">            prepared.setString(1, address);</span>
<span class="fc" id="L170">            ResultSet myRS = prepared.executeQuery();</span>
<span class="fc bfc" id="L171" title="All 2 branches covered.">            while (myRS.next()) {</span>
<span class="fc" id="L172">                building = new Building(</span>
<span class="fc" id="L173">                        myRS.getInt(&quot;idBuilding&quot;),</span>
<span class="fc" id="L174">                        myRS.getString(&quot;address&quot;),</span>
<span class="fc" id="L175">                        myRS.getString(&quot;cadastral&quot;),</span>
<span class="fc" id="L176">                        myRS.getString(&quot;area&quot;),</span>
<span class="fc" id="L177">                        myRS.getString(&quot;zipcode&quot;),</span>
<span class="fc" id="L178">                        myRS.getString(&quot;city&quot;),</span>
<span class="fc" id="L179">                        myRS.getString(&quot;conditionText&quot;),</span>
<span class="fc" id="L180">                        myRS.getString(&quot;service&quot;),</span>
<span class="fc" id="L181">                        myRS.getString(&quot;extraText&quot;),</span>
<span class="fc" id="L182">                        myRS.getString(&quot;builtYear&quot;),</span>
<span class="fc" id="L183">                        myRS.getInt(&quot;fk_idUser&quot;),</span>
<span class="fc" id="L184">                        myRS.getInt(&quot;fk_idMainPicture&quot;),</span>
<span class="fc" id="L185">                        myRS.getInt(&quot;fk_idReport&quot;),</span>
<span class="fc" id="L186">                        myRS.getString(&quot;dateCreated&quot;)</span>
                );
            }

<span class="nc" id="L190">        } catch (SQLException | HeadlessException ex) {</span>

<span class="fc" id="L192">        }</span>
<span class="fc" id="L193">        return building;</span>
    }

    public void submitReport(String buildingUsage, boolean roofRemarks,
            int fk_idPictureRoof, String roofText, boolean outerWallRemarks, int fk_idPictureOuterRoof, String outerWallText, int fk_idEmployee, String buildingResponsible) {
        try {
<span class="fc" id="L199">            String sql = &quot;INSERT INTO report (buildingUsage, roofRemarks, fk_idPictureRoof, roofText, outerWallRemarks, fk_idPictureOuterRoof, outerWallText, fk_idEmployee, buildingResponsible) VALUES &quot;</span>
                    + &quot;(?,?,(select idPicture from picture where idPicture=?),?,?,(select idPicture from picture where idPicture=?),?,(select idUser from user where idUser=?),?)&quot;;
<span class="fc" id="L201">            PreparedStatement prepared = conn.prepareStatement(sql);</span>
<span class="fc" id="L202">            prepared.setString(1, buildingUsage);</span>
<span class="pc bpc" id="L203" title="1 of 2 branches missed.">            prepared.setInt(2, (roofRemarks ? 1 : 0));</span>
<span class="fc" id="L204">            prepared.setInt(3, fk_idPictureRoof);</span>
<span class="fc" id="L205">            prepared.setString(4, roofText);</span>
<span class="fc" id="L206">            prepared.setBoolean(5, outerWallRemarks);</span>
<span class="fc" id="L207">            prepared.setInt(6, fk_idPictureOuterRoof);</span>
<span class="fc" id="L208">            prepared.setString(7, outerWallText);</span>
<span class="fc" id="L209">            prepared.setInt(8, fk_idEmployee);</span>
<span class="fc" id="L210">            prepared.setString(9, buildingResponsible);</span>
<span class="fc" id="L211">            prepared.executeUpdate();</span>
<span class="nc" id="L212">        } catch (SQLException | HeadlessException ex) {</span>
<span class="nc" id="L213">            JOptionPane.showMessageDialog(null, &quot;[DBBuilding.submitReport] &quot; + ex);</span>
<span class="fc" id="L214">        }</span>
<span class="fc" id="L215">    }</span>

    public String getRooms(int id) {
<span class="nc" id="L218">        String roomData = &quot;&quot;;</span>
        try {
<span class="nc" id="L220">            String sql = &quot;SELECT idRoomBuilding, roomDescribtion from roomBuilding where fk_idBuilding=?&quot;;</span>
<span class="nc" id="L221">            PreparedStatement prepared = conn.prepareStatement(sql);</span>
<span class="nc" id="L222">            prepared.setInt(1, id);</span>
<span class="nc" id="L223">            ResultSet myRS = prepared.executeQuery();</span>
<span class="nc bnc" id="L224" title="All 2 branches missed.">            while (myRS.next()) {</span>
<span class="nc" id="L225">                int roomID = myRS.getInt(&quot;idRoomBuilding&quot;);</span>
<span class="nc" id="L226">                String roomDesc = myRS.getString(&quot;roomDescribtion&quot;);</span>

<span class="nc" id="L228">                roomData += &quot;&lt;form action='Front' method='POST'&gt;&lt;input type='hidden' name='methodForm' value='serviceRoom'&gt;&lt;h4 style='color: white;'&gt;&quot; + roomDesc + &quot;&lt;/h4&gt;&lt;br&gt;&lt;p style='color:white;'&gt;&lt;button class='.btn-success' type='submit'&gt;Service Room&lt;/button&gt;&quot;</span>
                        + &quot;&lt;input type='hidden' name='idRoom' value='&quot; + roomID + &quot;'&gt;&lt;/td&gt;&quot;
                        + &quot;&lt;/form&gt;&quot;
                        + &quot;&lt;form action='Front' method='POST'&gt;&lt;input type='hidden' name='methodForm' value='editRoom'&gt;&lt;p style='color:white;'&gt;&lt;button class='.btn-success' type='submit'&gt;Edit Room&lt;/button&gt;&quot;
                        + &quot;&lt;input type='hidden' name='idRoom' value='&quot; + roomID + &quot;'&gt;&lt;/td&gt;&quot;
                        + &quot;&lt;/form&gt;&lt;br&gt;&quot;;
<span class="nc" id="L234">            }</span>
<span class="nc" id="L235">        } catch (SQLException | HeadlessException ex) {</span>

<span class="nc" id="L237">        }</span>
<span class="nc" id="L238">        return roomData;</span>
    }

    public void editBuilding(String address, String cadastral, String builtYear,
            String area, String zipcode, String city, String condition,
            String extraText, int userID) {
        try {
<span class="nc" id="L245">            String sql = &quot;UPDATE building set address=?, cadastral=?, builtYear=?, area=?, zipcode=?, city=?, conditionText=?, extraText=? WHERE idBuilding=?&quot;;</span>
<span class="nc" id="L246">            PreparedStatement prepared = conn.prepareStatement(sql);</span>
<span class="nc" id="L247">            prepared.setString(1, address);</span>
<span class="nc" id="L248">            prepared.setString(2, cadastral);</span>
<span class="nc" id="L249">            prepared.setString(3, builtYear);</span>
<span class="nc" id="L250">            prepared.setString(4, area);</span>
<span class="nc" id="L251">            prepared.setString(5, zipcode);</span>
<span class="nc" id="L252">            prepared.setString(6, city);</span>
<span class="nc" id="L253">            prepared.setString(7, condition);</span>
<span class="nc" id="L254">            prepared.setString(8, extraText);</span>
<span class="nc" id="L255">            prepared.setInt(9, userID);</span>
<span class="nc" id="L256">            prepared.executeUpdate();</span>

<span class="nc" id="L258">        } catch (SQLException | HeadlessException ex) {</span>

<span class="nc" id="L260">        }</span>
<span class="nc" id="L261">    }</span>

    public int getBuildingCount(int id) {
<span class="nc" id="L264">        int count = 0;</span>
        try {
<span class="nc" id="L266">            String sql = &quot;SELECT idBuilding FROM building WHERE fk_idUser=?&quot;;</span>
<span class="nc" id="L267">            PreparedStatement prepared = conn.prepareStatement(sql);</span>
<span class="nc" id="L268">            prepared.setInt(1, id);</span>
<span class="nc" id="L269">            ResultSet myRS = prepared.executeQuery();</span>
<span class="nc bnc" id="L270" title="All 2 branches missed.">            while(myRS.next()){</span>
<span class="nc" id="L271">                count++;</span>
            }
<span class="nc" id="L273">        } catch (SQLException | HeadlessException ex) {</span>

<span class="nc" id="L275">        }</span>
<span class="nc" id="L276">        return count;</span>
    }

    public int getBuildingCount() {
<span class="fc" id="L280">        int count = 0;</span>
        try {
<span class="fc" id="L282">            String sql = &quot;SELECT idBuilding FROM building&quot;;</span>
<span class="fc" id="L283">            PreparedStatement prepared = conn.prepareStatement(sql);</span>
<span class="fc" id="L284">            ResultSet myRS = prepared.executeQuery();</span>
<span class="fc bfc" id="L285" title="All 2 branches covered.">            while(myRS.next()){</span>
<span class="fc" id="L286">                count++;</span>
            }
<span class="nc" id="L288">        } catch (SQLException | HeadlessException ex) {</span>

<span class="fc" id="L290">        }</span>
<span class="fc" id="L291">        return count;</span>
    }
    
    public String getService(int idUser) {
<span class="nc" id="L295">        String tableData = &quot;&lt;table class='table table-hover'&gt;\n&quot;</span>
                + &quot;    &lt;thead&gt;\n&quot;
                + &quot;      &lt;tr&gt;\n&quot;
                + &quot;        &lt;th&gt;Address&lt;/th&gt;\n&quot;
                + &quot;        &lt;th&gt;City&lt;/th&gt;\n&quot;
                + &quot;        &lt;th&gt;Building Year&lt;/th&gt;\n&quot;
                + &quot;      &lt;/tr&gt;\n&quot;
                + &quot;    &lt;/thead&gt;\n&quot;
                + &quot;    &lt;tbody&gt;&quot;;
        try {
            /*
    int idBuilding, String address, String cadastral, String buildingGrade, 
    String area, String zipcode, String city, String condition, String service, 
    String extraText, double buildingArea, int builtYear, int fk_idUser, 
    int fk_MainPicture, int fk_idReport, Date dateCreated
             */

<span class="nc" id="L312">            String sql = &quot;SELECT idBuilding, address, cadastral, builtYear, area, zipcode, city, condition, service, extraText, dateCreated, fk_idUser, fk_idMainPicture, fk_idReport FROM building WHERE fk_idUser=?&quot;;</span>
<span class="nc" id="L313">            PreparedStatement prepared = conn.prepareStatement(sql);</span>
<span class="nc" id="L314">            prepared.setInt(1, idUser);</span>
<span class="nc" id="L315">            ResultSet myRS = prepared.executeQuery();</span>
<span class="nc bnc" id="L316" title="All 2 branches missed.">            while (myRS.next()) {</span>
<span class="nc" id="L317">                int idBuilding = myRS.getInt(&quot;idBuilding&quot;);</span>
<span class="nc" id="L318">                String address = myRS.getString(&quot;address&quot;);</span>
<span class="nc" id="L319">                String city = myRS.getString(&quot;city&quot;);</span>
<span class="nc" id="L320">                int builtYear = myRS.getInt(&quot;builtYear&quot;);</span>

<span class="nc" id="L322">                tableData += &quot;&lt;tr&gt;&lt;form method ='POST' action='Front'&gt;&lt;td&gt;&quot; + address + &quot;&lt;/td&gt;&lt;td&gt;&quot; + city + &quot;&lt;/td&gt;&lt;td&gt;&quot; + builtYear + &quot;&lt;input type='hidden' name='methodForm' value='serviceBuilding'&gt;&lt;input type='hidden' name='idBuilding' value='&quot; + idBuilding + &quot;'&gt;&lt;/td&gt;&lt;/tr&gt;&quot;;</span>

//                Building building = new Building(myRS.getInt(&quot;idBuilding&quot;), 
//                                                 myRS.getString(&quot;address&quot;),
//                                                 myRS.getString(&quot;cadastral&quot;),
//                                                 myRS.getString(&quot;buildingGrade&quot;),
//                                                 myRS.getString(&quot;area&quot;),
//                                                 myRS.getString(&quot;zipcode&quot;),
//                                                 myRS.getString(&quot;city&quot;),
//                                                 myRS.getString(&quot;condition&quot;),
//                                                 myRS.getString(&quot;service&quot;),
//                                                 myRS.getString(&quot;extraText&quot;),
//                                                 myRS.getDouble(&quot;buildingArea&quot;),
//                                                 myRS.getInt(&quot;builtYear&quot;),
//                                                 myRS.getInt(&quot;fk_idUser&quot;),
//                                                 myRS.getInt(&quot;fk_MainPicture&quot;),
//                                                 myRS.getInt(&quot;fk_idReport&quot;),
//                                                 myRS.getDate(&quot;dateCreated&quot;)
//                                                );
//                buildingList.add(building);
<span class="nc" id="L342">            }</span>
<span class="nc" id="L343">        } catch (SQLException | HeadlessException ex) {</span>

<span class="nc" id="L345">        }</span>
<span class="nc" id="L346">        tableData += &quot;&lt;/tbody&gt;\n&quot;</span>
                + &quot;  &lt;/table&gt;&quot;;
<span class="nc" id="L348">        return tableData;</span>
    }

    public String createMenu(String status) {
<span class="nc" id="L352">        DBUserHandler db = new DBUserHandler(conn);</span>
<span class="nc" id="L353">        String menu = &quot;&quot;;</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">        if (status.equalsIgnoreCase(&quot;customer&quot;)) {</span>
<span class="nc" id="L355">            return &quot;&lt;li&gt;&lt;a href='overviewBuilding.jsp'&gt;Estate&lt;/a&gt;&lt;/li&gt;\n&quot;</span>
                    + &quot;            &lt;li&gt;&lt;a href='service.jsp'&gt;Service Overview&lt;/a&gt;&lt;/li&gt;\n&quot;
                    + &quot;            &lt;li&gt;&lt;a href='account.jsp'&gt;Account Management&lt;/a&gt;&lt;/li&gt;\n&quot;
                    + &quot;            &lt;li&gt;&lt;a href='contact.jsp'&gt;Contact Staff&lt;/a&gt;&lt;/li&gt;&quot;;
<span class="nc bnc" id="L359" title="All 2 branches missed.">        } else if (status.equalsIgnoreCase(&quot;worker&quot;)) {</span>
<span class="nc" id="L360">            return &quot;&lt;li&gt;&lt;a href='overviewBuilding.jsp'&gt;Estates&lt;/a&gt;&lt;/li&gt;\n&quot;</span>
                    + &quot;            &lt;li&gt;&lt;a href='service.jsp'&gt;Service Overview&lt;/a&gt;&lt;/li&gt;\n&quot;
<span class="nc" id="L362">                    + &quot;            &lt;li&gt;&lt;a href='overviewUsers.jsp'&gt;Account Management(&quot; + db.countUnConfirmed() + &quot;)&lt;/a&gt;&lt;/li&gt;\n&quot;</span>
                    + &quot;            &lt;li&gt;&lt;a href='contact.jsp'&gt;Contact Staff&lt;/a&gt;&lt;/li&gt;&quot;;
<span class="nc bnc" id="L364" title="All 2 branches missed.">        } else if (status == null) {</span>
<span class="nc" id="L365">            return &quot;Unspecified Login. Please retry!&quot;;</span>
        }
<span class="nc" id="L367">        return &quot;&quot;;</span>
    }

    public String getReportField(int reportID, String fieldName) {
        try {
<span class="nc" id="L372">            String sql = &quot;SELECT ? FROM report where &quot;;</span>
<span class="nc" id="L373">            PreparedStatement prepared = conn.prepareStatement(sql);</span>

<span class="nc" id="L375">        } catch (Exception e) {</span>
<span class="nc" id="L376">            e.printStackTrace();</span>
<span class="nc" id="L377">        }</span>
<span class="nc" id="L378">        return null;</span>
    }

    public void removeBuilding(int id) {
        try {
<span class="fc" id="L383">            String sql = &quot;DELETE FROM building WHERE idBuilding=?&quot;;</span>
<span class="fc" id="L384">            PreparedStatement prepared = conn.prepareStatement(sql);</span>
<span class="fc" id="L385">            prepared.setInt(1, id);</span>
<span class="fc" id="L386">            prepared.executeUpdate();</span>
<span class="nc" id="L387">        } catch (Exception e) {</span>
<span class="nc" id="L388">            e.printStackTrace();</span>
<span class="fc" id="L389">        }</span>
<span class="fc" id="L390">    }</span>

    public String getImageHTML(int id) {
<span class="nc" id="L393">        return &quot;&lt;img src=\&quot;ImageServlet?id=&quot; + id + &quot;\&quot;/&gt;&quot;;</span>
    }
    
    public String getImageHTML(int id, int width, int height) {
<span class="nc" id="L397">        return &quot;&lt;img src=\&quot;ImageServlet?id=&quot; + id + &quot;\&quot; height=\&quot;&quot; + height + &quot;\&quot; width=\&quot;&quot; + width+ &quot;\&quot;/&gt;&quot;;</span>
    }

    public Image getImage() {
<span class="nc" id="L401">        String sql = &quot;SELECT * FROM picture WHERE idPicture=?&quot;;</span>
        try {
<span class="nc" id="L403">            PreparedStatement prepared = conn.prepareStatement(sql);</span>
<span class="nc" id="L404">            ResultSet rs = prepared.executeQuery();</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">            while (rs.next()) {</span>
<span class="nc" id="L406">                Blob blob = rs.getBlob(&quot;image&quot;);</span>
<span class="nc" id="L407">                InputStream inputStream = blob.getBinaryStream();</span>
<span class="nc" id="L408">                BufferedImage image = ImageIO.read(inputStream);</span>
<span class="nc" id="L409">                return image;</span>
            }
<span class="nc" id="L411">        } catch (Exception e) {</span>

<span class="nc" id="L413">        }</span>
<span class="nc" id="L414">        return null;</span>
    }

    public int uploadMainImage(String description, String type, Part filePart, int buildingID, int fk_idMainPicture) {
        try {
<span class="nc" id="L419">            String sql = &quot;DELETE FROM picture WHERE idPicture=?&quot;;</span>
<span class="nc" id="L420">            PreparedStatement prepared = conn.prepareStatement(sql);</span>
<span class="nc" id="L421">            prepared.setInt(1, fk_idMainPicture);</span>
<span class="nc" id="L422">            prepared.executeUpdate();</span>
<span class="nc" id="L423">            int returnValue = uploadImage(description, type, filePart);</span>
<span class="nc bnc" id="L424" title="All 2 branches missed.">            if (returnValue &gt;= 0) {</span>
<span class="nc" id="L425">                sql = &quot;UPDATE building SET fk_idMainPicture = ? WHERE idBuilding = ?&quot;;</span>
<span class="nc" id="L426">                prepared = conn.prepareStatement(sql);</span>
<span class="nc" id="L427">                prepared.setInt(1, returnValue);</span>
<span class="nc" id="L428">                prepared.setInt(2, buildingID);</span>
<span class="nc" id="L429">                prepared.executeUpdate();</span>
<span class="nc" id="L430">                return returnValue;</span>
            } else {
<span class="nc" id="L432">                JOptionPane.showMessageDialog(null, &quot;[DBBuildingHandler.uploadMainImage] Error, returnValue: &quot; + returnValue);</span>
            }
<span class="nc" id="L434">        } catch (Exception e) {</span>
<span class="nc" id="L435">            JOptionPane.showMessageDialog(null, &quot;[DBBuildingHandler.uploadMainImage] &quot; + e.getMessage());</span>
<span class="nc" id="L436">            e.printStackTrace();</span>
<span class="nc" id="L437">        }</span>
<span class="nc" id="L438">        return -1;</span>
    }
    
    public int uploadImage(String description, String type, Part filePart) {
        try {
<span class="nc" id="L443">            String sql = &quot;INSERT INTO picture (description, type, image) VALUES (?, ?, ?)&quot;;</span>
<span class="nc" id="L444">            PreparedStatement prepared = conn.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);</span>
<span class="nc" id="L445">            InputStream inputStream = null;</span>
<span class="nc bnc" id="L446" title="All 2 branches missed.">            if (filePart != null) {</span>
<span class="nc" id="L447">                inputStream = filePart.getInputStream();</span>
            }
<span class="nc bnc" id="L449" title="All 2 branches missed.">            if (inputStream != null) {</span>
<span class="nc" id="L450">                prepared.setString(1, description);</span>
<span class="nc" id="L451">                prepared.setString(2, type);</span>
<span class="nc" id="L452">                prepared.setBlob(3, inputStream);</span>
<span class="nc" id="L453">                prepared.executeUpdate();</span>
<span class="nc" id="L454">                ResultSet rs = prepared.getGeneratedKeys();</span>
<span class="nc bnc" id="L455" title="All 2 branches missed.">                while (rs.next()) {</span>
<span class="nc" id="L456">                    return rs.getInt(1);</span>
                }
            }
<span class="nc" id="L459">        } catch (Exception e) {</span>
<span class="nc" id="L460">            e.printStackTrace();</span>
<span class="nc" id="L461">        }</span>
<span class="nc" id="L462">        return -1;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>